# 五步流水线总览与子技能调用关系

## 流水线全景

```
┌──────────────────────────────────────────────────────────────────┐
│                    0-pipeline-orchestrator                        │
│                                                                  │
│  输入: 自然语言描述                                                │
│  ┌──────────┐  ┌───────────┐  ┌──────────────┐  ┌───────────┐   │
│  │①agent-   │─▶│②thumbnail │─▶│③military-    │─▶│④3d-model  │   │
│  │  json    │  │           │  │  symbol      │  │           │   │
│  └──────────┘  └───────────┘  └──────────────┘  └─────┬─────┘   │
│                                                       │         │
│                    ┌──────────────────┐                │         │
│                    │  校验关卡         │◀───────────────┘         │
│                    │ • 缩略图一致性    │                          │
│                    │ • 3D 质量门控     │                          │
│                    │ • 路径引用一致    │                          │
│                    └────────┬─────────┘                          │
│                             │ 通过                               │
│                    ┌────────▼─────────┐                          │
│                    │ ⑤zip-packaging   │                          │
│                    └────────┬─────────┘                          │
│                             │                                    │
│  输出: {ModelName}.zip      ▼                                    │
└──────────────────────────────────────────────────────────────────┘
```

## LangGraph V2 节点到子技能映射

| LangGraph 节点 | 对应子技能 |
|----------------|-----------|
| `search_equipment_info` | Web 搜索 + LLM 提取 |
| `construct_lavicagent_data` | `1-agent-json` |
| `add_image_data` | `2-thumbnail` |
| `text_to_model` | `4-3d-model` |
| `choose_dynamics` | `1-agent-json`（动力学选择） |
| `add_actions` | `1-agent-json`（动作指令配置） |
| `submit_lavic_agent` | LaViC API 提交 |

## 错误处理策略

| 失败环节 | 处理方式 |
|----------|----------|
| agent.json Schema 校验失败 | 终止流水线，报告校验错误 |
| 缩略图搜索无结果 | 降级为 GLB 离线渲染缩略图 |
| 军标生成失败 | 使用通用 fallback SIDC 重试 |
| 3D 模型质量不达标 | 回退重生成（更换提示词/来源） |
| 缩略图与 3D 不一致 | 用 GLB 渲染图替换缩略图 |
| 打包前校验不通过 | 拒绝打包，报告具体原因 |
