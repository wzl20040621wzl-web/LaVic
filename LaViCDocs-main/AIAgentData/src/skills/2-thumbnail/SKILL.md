---
name: thumbnail
description: "当需要为仿真模型搜索、下载、优选缩略图，进行缩略图格式转换(→RGB PNG)，
  执行缩略图去重校验(pHash/SSIM)，或进行缩略图与3D模型一致性校验时触发。
  严禁使用军标图(*_mil.png)作为缩略图。"
---

# Thumbnail — 缩略图获取与优选

## 1. Overview

本技能负责为仿真模型获取高质量缩略图。缩略图是模型在 LaViC 平台中的视觉预览，必须清晰、风格一致、与 3D 模型外形匹配。

**产出文件**：`{ModelName}.png`

## 2. 触发条件

- 需要为新模型搜索和下载缩略图
- 需要对现有缩略图进行格式转换或质量评估
- 需要执行缩略图去重校验
- 需要校验缩略图与 3D 模型的一致性

## 3. 搜索与优选流程

### 3.1 搜索策略

1. 使用 Web Search 搜索 3-5 张候选图片
2. 搜索关键词示例：`"{ModelName}" 3D render white background`
3. 如返回结果不佳，优化搜索词重新尝试（加入英文名/NATO代号/型号等）

### 3.2 风格标准 (Style Guidelines)

**优先级排序**：

| 优先级 | 风格 | 说明 |
|--------|------|------|
| 1（最高） | 3D 渲染图 (3D Studio Render) | 最佳选择 |
| 2 | 干净背景实拍图 (Clean Photo) | 白/灰/透明背景 |
| 3 | 实拍图 (Real Photo) | 可接受，但非首选 |

### 3.3 背景要求

优先选择：
- **白色**背景
- **灰色 (Studio Grey)** 背景
- **透明**背景

避免：复杂环境/战场/大量文字水印

### 3.4 视角要求

**最佳视角**：三分之四前视角 (Front 3/4 View) + 轻俯视 (Slight Top-Down)

| 参数 | 推荐值 |
|------|--------|
| 俯仰角 | 15–25°（能看到机背/车顶） |
| 偏航角 | 30–45°（机头朝向画面右前或左前） |
| 构图 | 主体完整入镜，留少量边缘留白 |

**视角优先级**：3/4 前视角轻俯视 > 3/4 等轴侧视图 > 正侧视图

**避免**：极端仰视、正俯视

### 3.5 自动评分择优

对每张候选图片计算综合得分：

```python
score = resolution (width × height)
if aspect_ratio > 2.5 or aspect_ratio < 0.5:
    score *= 0.5  # 惩罚极端宽高比
```

**最低门槛**：
- 分辨率 > 800px（宽或高）
- 宽度 ≥ 400px 且高度 ≥ 300px
- 主体在图中占比适中，无严重遮挡

## 4. 格式规范

| 项目 | 要求 |
|------|------|
| 格式 | PNG（优先）或 JPG |
| 色彩模式 | RGB |
| 命名 | `{ModelName}.png` |
| 分辨率 | 建议 ≥ 800px |

使用 `check_and_convert_images.py` 进行格式转换：
- 非 RGB 模式 → 转换为 RGB
- 非 PNG 格式 → 转存为 PNG

## 5. 去重校验

### 5.1 校验范围

与 `models/` 目录已有模型的缩略图比对：
- `models/*/{ModelName}/{ModelName}.png|jpg`
- `models/*/{ModelName}/{ModelName}_mil.png`

### 5.2 判定准则

满足以下**任一**条件即为"高相似"（重复），必须剔除：

| 指标 | 阈值 |
|------|------|
| pHash 汉明距离 | < 8 |
| SSIM 结构相似度 | ≥ 0.75 |

### 5.3 重复处理

- 剔除该候选图，选取下一张
- 若所有候选均重复，更换搜索关键词重试
- 最终兜底：使用 GLB 离线渲染图

## 6. 缩略图与 3D 模型一致性校验

### 6.1 校验流程

1. 从 GLB 离线渲染一张预览图（等轴侧视角、白/灰背景、分辨率 ≥ 1024px）
2. 计算缩略图与渲染图的三项相似度指标
3. 三项至少满足两项即通过

### 6.2 指标与阈值

| 指标 | 阈值 | 算法 |
|------|------|------|
| 结构相似度 SSIM | ≥ 0.45 | skimage.metrics.structural_similarity |
| 边缘轮廓 IoU | ≥ 0.60 | Canny 边缘 + 形态学闭合 |
| 颜色直方图相关性 | ≥ 0.50 | HSV 3×64 bins |

### 6.3 不通过的处理

- 若缩略图命名为 `*_mil.png` → 直接用 GLB 渲染图替换
- 若相似度不足 → 用 GLB 离线渲染图替换缩略图
- 若无法渲染 → 中止打包并记录错误

## 7. 禁止项

- **严禁使用军标图 (`*_mil.png`) 作为缩略图**
- 严禁使用无效或低质量占位符
- 严禁使用与其他模型高度相似的图片

## 8. 兜底顺序

```
高质量公开版权实拍/渲染图
    │ 找不到
    ▼
GLB 离线渲染（Blender 无头渲染，等轴视角、纯色背景）
    │ 渲染失败
    ▼
暂停打包并报错（不允许以军标代替缩略图）
```

## 9. Scripts

| 脚本 | 功能 |
|------|------|
| `scripts/fetch_images.py` | Web 搜索 + 爬取候选缩略图，自动评分择优 |
| `scripts/download_images.py` | 批量下载图片 |
| `scripts/check_and_convert_images.py` | 格式检查与转换（→ RGB PNG） |
| `scripts/resolve_wiki_images.py` | Wikimedia 缩略图 URL 转全分辨率 URL |
| `scripts/add_image_data.py` | 通过 Tavily API 搜索装备图片并写入 agent 数据 |

## 10. Resources

- `references/thumbnail_style_guide.md` — 完整的风格标准、视角参数、评分算法
